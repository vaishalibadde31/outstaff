{% extends "base.html" %}
{% block content %}
<div class="space-y-6">
  <div class="flex items-center justify-between">
    <div>
      <p class="text-sm uppercase tracking-wide text-brand-700 font-semibold">My time</p>
      <h1 class="text-3xl font-bold">{{ org.name }}</h1>
      <p class="text-slate-600">Log daily/weekly time. Draft before you submit. Overlaps are blocked.</p>
    </div>
    <div class="flex items-center gap-2">
      <a class="btn btn-secondary" href="{{ url_for('time.dashboard', org_id=org.id) }}">Dashboard</a>
      {% if membership.role == Role.ADMIN %}
      <a class="btn btn-secondary" href="{{ url_for('time.approvals', org_id=org.id) }}">Approvals</a>
      {% endif %}
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 card p-6 space-y-3">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Entries</h2>
        <span class="pill">{{ entries|length }} logged</span>
      </div>
      <div class="space-y-3">
        {% for entry in entries %}
        <div class="border border-slate-100 rounded-xl px-4 py-3">
          <div class="flex items-center justify-between">
            <div>
              <p class="font-semibold text-slate-900">{{ entry.project.name if entry.project else "General" }}</p>
              <p class="text-sm text-slate-600">{{ entry.date }} • {{ entry.start_at.strftime('%H:%M') }} → {{ entry.end_at.strftime('%H:%M') }} • {{ (entry.duration_minutes / 60)|round(2) }}h</p>
              {% if entry.notes %}<p class="text-sm text-slate-600">{{ entry.notes }}</p>{% endif %}
              {% if entry.return_reason %}<p class="text-sm text-amber-700">Returned: {{ entry.return_reason }}</p>{% endif %}
            </div>
            <span class="badge">{{ entry.status.value|capitalize }}</span>
          </div>
          <div class="mt-3 flex items-center gap-2 flex-wrap">
            <a class="btn btn-secondary" href="{{ url_for('time.edit_entry', org_id=org.id, entry_id=entry.id) }}">Edit</a>
            <form method="POST" action="{{ url_for('time.delete_entry', org_id=org.id, entry_id=entry.id) }}" onsubmit="return confirm('Delete entry?');">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button class="btn bg-rose-50 text-rose-700 hover:bg-rose-100" type="submit">Delete</button>
            </form>
          </div>
        </div>
        {% else %}
        <p class="text-slate-600">No entries yet. Log time on the right.</p>
        {% endfor %}
      </div>
    </div>

    <div class="card p-6 space-y-3">
      <h3 class="text-lg font-semibold">Log time</h3>
      <form method="POST" class="space-y-3">
        {{ form.hidden_tag() }}
        <div class="space-y-2">
          {{ form.date.label }}
          {{ form.date(class_="w-full") }}
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="space-y-2">
            {{ form.project_id.label }}
            {{ form.project_id(class_="w-full") }}
          </div>
          <div class="space-y-2">
            {{ form.activity_id.label }}
            {{ form.activity_id(class_="w-full") }}
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="space-y-2">
            {{ form.start_at.label }}
            {{ form.start_at(class_="w-full") }}
          </div>
          <div class="space-y-2">
            {{ form.end_at.label }}
            {{ form.end_at(class_="w-full") }}
          </div>
        </div>
        <div class="space-y-2">
          <label class="flex items-center gap-2">{{ form.billable() }} Billable</label>
        </div>
        <div class="space-y-2">
          {{ form.tags.label }}
          {{ form.tags(class_="w-full") }}
        </div>
        <div class="space-y-2">
          {{ form.status.label }}
          {{ form.status(class_="w-full") }}
        </div>
        <div class="space-y-2">
          {{ form.notes.label }}
          {{ form.notes(class_="w-full") }}
        </div>
        <button class="btn btn-primary w-full" type="submit">{{ form.submit.label.text }}</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
